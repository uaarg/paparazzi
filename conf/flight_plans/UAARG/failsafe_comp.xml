<!DOCTYPE procedure SYSTEM "../flight_plan.dtd">

<procedure>

  <header>
    #include "subsystems/datalink/datalink.h"
    #include "subsystems/radio_control.h"
    #include "subsystems/commands.h"

    #define datalink_standbys 5
    #define datalink_terminations 120
    #define rc_ok 0
  </header>

  <exceptions>
    <exception cond="(datalink_time > datalink_standbys)*(datalink_terminations > datalink_time)*((InsideOperationc(GetPosX(), GetPosY())))" deroute="Termination_Recovery"/> <!-- Lost Telemetry Link, sends plane to circle WP standby-->

    <exception cond="(datalink_time > datalink_terminations)" deroute="Termination"/> <!-- if the plane the plane has lost the datalink for longer than datalink_termination, the plane will automatically go into sucicide.-->

    <!--exception cond="(!InsideOperationa(GetPosX(), GetPosY()))*(!InsideOperationb(GetPosX(), GetPosY()))*(!InsideOperationc(GetPosX(), GetPosY()))*(!InsideOperationd(GetPosX(), GetPosY()))*(datalink_time > datalink_standby)" deroute="Termination" /-->


    <!-- Add conditions that deroute to suicide in here. Make sure to also add to the exception within suicide.-->

    <!-- End of conditions for suicide -->
  </exceptions>

  <blocks>



    <block name="Absolute_Termination"><!-- for GCS operator to kill the plane. Does not deroute-->
      <set value="1" var="kill_throttle"/>
      <attitude climb="2000" height="0" roll="2000" throttle="0" vmode="throttle"/>
      
    </block>

    <block name="Termination"><!-- block designed to automatically terminate the plane unless conditions are met-->
      <set value="1" var="kill_throttle"/>
      <attitude climb="2000" height="0" roll="2000" throttle="0" vmode="throttle"/>
      <exception cond="2 > datalink_time" deroute="Termination_Recovery"/>
      
    </block>


    <block name="Termination_Recovery"><!--Termination recovery block designed to restart motor-->
      <set value="0" var="kill_throttle"/>
      <deroute block="Standby"/>
    </block>



  </blocks>

</procedure>
